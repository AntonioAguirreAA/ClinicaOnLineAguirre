<div class="register-container">
  <form [formGroup]="registroForm" (ngSubmit)="onSubmit()">
    <h2>Registrarse</h2>

    <!-- Tipo de usuario -->
    <label for="tipoUsuario">Tipo de usuario</label>
    <div class="tipo-usuario-buttons">
      <button
        type="button"
        (click)="setTipoUsuario('paciente')"
        [class.selected]="registroForm.get('tipoUsuario')?.value === 'paciente'"
      >
        <img src="assets/paciente.png" alt="Paciente" />
      </button>
      <button
        type="button"
        (click)="setTipoUsuario('especialista')"
        [class.selected]="
          registroForm.get('tipoUsuario')?.value === 'especialista'
        "
      >
        <img src="assets/doctor.png" alt="Especialista" />
      </button>
    </div>

    <!-- Nombre -->
    <label for="nombre">Nombre</label>
    <input type="text" formControlName="nombre" id="nombre" />

    <!-- Apellido -->
    <label for="apellido">Apellido</label>
    <input type="text" formControlName="apellido" id="apellido" />

    <!-- Edad -->
    <label for="edad">Edad</label>
    <input type="number" formControlName="edad" id="edad" />

    <!-- DNI -->
    <label for="dni">DNI</label>
    <input type="text" formControlName="dni" id="dni" />

    <!-- Obra Social solo para paciente -->
    <div *ngIf="tipoUsuario === 'paciente'">
      <label for="obraSocial">Obra Social</label>
      <input type="text" formControlName="obraSocial" id="obraSocial" />

      <label for="img2">Imagen 2</label>
      <input type="file" (change)="agregarImagen($event)" />
    </div>

    <!-- Especialidades solo para especialista -->
    <div *ngIf="tipoUsuario === 'especialista'">
      <h3>Especialidades</h3>

      <!-- Selección -->
      <label>Seleccionar Especialidad</label>
      <select (change)="agregarEspecialidadExistente($event)">
        <option value="" disabled selected>Selecciona una especialidad</option>
        <option *ngFor="let esp of especialidades" [value]="esp.id">
          {{ esp.nombre }}
        </option>
      </select>

      <!-- Listado -->
      <div formArrayName="especialidades">
        <div
          *ngFor="let control of especialidadesArray.controls; let i = index"
        >
          <p>
            {{ control.value }}
            <button type="button" (click)="especialidadesArray.removeAt(i)">
              Eliminar
            </button>
          </p>
        </div>
      </div>

      <!-- Nueva -->
      <label for="nuevaEspecialidad">Nueva Especialidad</label>
      <input
        type="text"
        formControlName="nuevaEspecialidad"
        placeholder="Nueva especialidad"
      />
      <button type="button" (click)="agregarEspecialidad()">Agregar</button>
    </div>

    <!-- Imagen 1 común -->
    <label for="img1">Imagen 1</label>
    <input type="file" (change)="agregarImagen($event)" />

    <!-- Email y contraseña -->
    <label for="email">Email</label>
    <input type="email" formControlName="email" id="email" />

    <label for="password">Contraseña</label>
    <input type="password" formControlName="password" id="password" />

    <!-- Captcha -->
    <re-captcha
      class="captcha"
      siteKey="6LfYr3wqAAAAAI6opWRi2sTNVD1xthY74Q_gX0n-"
      (resolved)="onCaptchaResolved($event)"
    ></re-captcha>

    <button
      type="submit"
      [disabled]="registroForm.invalid || !recaptchaResponse"
    >
      Registrarse
    </button>
  </form>

  <p>
    ¿Ya tienes una cuenta? <a [routerLink]="['/login']">Iniciar sesión aquí</a>
  </p>
</div>
